# https://mise.jdx.dev/configuration.html
[settings]
experimental = true

[tools]
rust = "nightly-2026-01-24"
hk = "1.32.0"
pkl = "0.30.2"
"cargo:cargo-release" = "latest"
"cargo:git-cliff" = "latest"

[env]
LSP_BINARY = "js-i18n-language-server"

[hooks]
postinstall = "hk install"

[tasks.build]
description = "Build the LSP binary"
run = "cargo build"
sources = ["Cargo.toml", "src/**/*.rs"]
outputs = ["target/debug/{{env.LSP_BINARY}}"]

[tasks.build-install]
description = "Build and install the LSP binary"
run = "cargo install --path . --force --debug"
sources = ["Cargo.toml", "src/**/*.rs", "queries/**/*"]
outputs = ["{{env.CARGO_HOME}}/bin/{{env.LSP_BINARY}}"]

[tasks.test]
description = "Run tests"
run = "cargo test --workspace --all-features"

[tasks.lint]
description = "Run lints"
run = "cargo clippy --workspace --all-targets --all-features -- -D warnings"

[tasks.lint-fix]
description = "Run lints and fix them"
run = "cargo clippy --workspace --all-targets --all-features --fix --allow-dirty --allow-staged"

[tasks.format]
description = "Format the code"
run = "cargo fmt --all"

[tasks.install-components]
description = "Install components"
run = [
  "rustup component add rust-analyzer",
  "rustup component add rustfmt",
  "rustup component add clippy",
  "rustup component add llvm-tools-preview",
  "cargo install cargo-llvm-cov",
]

[tasks.coverage]
description = "Run tests with coverage"
run = "cargo llvm-cov --workspace --all-features"

[tasks.coverage-html]
description = "Run tests with coverage and generate HTML report"
run = "cargo llvm-cov --workspace --all-features --html --open"

[tasks.release]
description = "Preview release (dry-run). Usage: mise run release [patch|minor|major|x.y.z]"
run = "cargo release ${1:-patch}"

[tasks.release-execute]
description = "Execute release. Usage: mise run release-execute [patch|minor|major|x.y.z]"
run = "cargo release ${1:-patch} --execute"

[tasks.changelog]
description = "Preview CHANGELOG generation"
run = "git-cliff --unreleased"
